<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="shortcut icon" href="../img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="../css/repo.css">
    <title>Repositório Atual</title>
</head>

<body>
    <div id="container">
        <header>
            <a href="../home.html" id="area-logo">
                <img src="../img/github-logo.png" alt="GitHub Logo">
                <h2><span class="gray">Pesquisa de repositórios</span> - GitHub</h2>
            </a>
        </header>
        <main id="container">
            <div id="repo-info">
                <a id="avatar-link" target="_blank" href="">
                    <img id="avatar" src="" alt="">
                </a>
                <section>
                    <div>
                        <a id="repo-link" target="_blank" href="">
                            <h2 id="userAndRepo"></h2>
                        </a>
                        <a id="link-fork" target="_blank" href="">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <path
                                    d="M7,12 L14.5,12 C16.277025,12 17.7447372,10.6756742 17.970024,8.96013518 C16.2885152,8.7047201 15,7.25283448 15,5.5 C15,3.56700338 16.5670034,2 18.5,2 C20.4329966,2 22,3.56700338 22,5.5 C22,7.27155475 20.6838151,8.73569805 18.9759671,8.96790818 C18.7419236,11.2333126 16.8272778,13 14.5,13 L7,13 L7,15.0354444 C8.69614707,15.2780593 10,16.736764 10,18.5 C10,20.4329966 8.43299662,22 6.5,22 C4.56700338,22 3,20.4329966 3,18.5 C3,16.736764 4.30385293,15.2780593 6,15.0354444 L6,8.96455557 C4.30385293,8.72194074 3,7.26323595 3,5.5 C3,3.56700338 4.56700338,2 6.5,2 C8.43299662,2 10,3.56700338 10,5.5 C10,7.26323595 8.69614707,8.72194074 7,8.96455557 L7,12 Z M4,18.5 C4,19.8807119 5.11928813,21 6.5,21 C7.88071187,21 9,19.8807119 9,18.5 C9,17.1192881 7.88071187,16 6.5,16 C5.11928813,16 4,17.1192881 4,18.5 Z M4,5.5 C4,6.88071187 5.11928813,8 6.5,8 C7.88071187,8 9,6.88071187 9,5.5 C9,4.11928813 7.88071187,3 6.5,3 C5.11928813,3 4,4.11928813 4,5.5 Z M18.5,3 C17.1192881,3 16,4.11928813 16,5.5 C16,6.88071187 17.1192881,8 18.5,8 C19.8807119,8 21,6.88071187 21,5.5 C21,4.11928813 19.8807119,3 18.5,3 Z" />
                            </svg>
                        </a>
                    </div>
                    <p id="description"></p>
                </section>
            </div>
            <div id="repo-metrics">
                <section class="metric">
                    <strong id="stars">0</strong>
                    <span>Stars</span>
                </section>
                <section class="metric">
                    <strong id="forks">0</strong>
                    <span>Forks</span>
                </section>
                <section class="metric">
                    <strong id="watchers"></strong>
                    <span>Watchers</span>
                </section>
            </div>
            <section id="languages">
                <h2>Linguagens utilizadas (ordem decrescente)</h2>
                <ul id="language"></ul>
            </section>
        </main>
    </div>
</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    let baseURL = 'https://api.github.com';

    let repo = localStorage.getItem('repo');

    let colors = ['#FE2E2E', '#FE9A2E', '#2EFE2E', '#2E2EFE', '#2ECCFA', '#CC2EFA', '#585858'];

    const getLanguages = async (apiLanguages) => {
        let language = document.getElementById('language');
        let languageValues = [];
        let totalValue;

        let { data } = await axios.get(apiLanguages);
        Object.keys(data).forEach(item => {
            languageValues.push(data[item]);
            totalValue = languageValues.reduce((total, num) => total + num);            
        });

        Object.keys(data).forEach(item => {
            let li = document.createElement('li');
            let percent = ((data[item] * 100) / totalValue).toFixed(1);
            let span = document.createElement('span');
            span.innerHTML = `${percent}%`;
            let random = (Math.random() * 6).toFixed(0);
            span.style.color = colors[random];
            li.innerHTML = `${item}: `;
            li.append(span);
            language.appendChild(li);
        });

    }

    const getRepo = async () => {
        let { data } = await axios.get(`${baseURL}/repos/${repo}`);
        document.getElementById('avatar').setAttribute('src', data.owner.avatar_url);
        document.getElementById('avatar').setAttribute('alt', 'Avatar usuário');
        document.getElementById('avatar-link').setAttribute('href', data.owner.html_url);
        document.getElementById('userAndRepo').innerHTML = data.full_name;
        document.getElementById('repo-link').setAttribute('href', data.html_url);
        document.getElementById('description').innerHTML = data.description || 'Sem descrição...';

        if (!data.fork) {
            document.getElementById('link-fork').style.display = 'none';
        } else {
            document.getElementById('link-fork').setAttribute('href', data.parent.html_url);
        }

        document.getElementById('stars').innerHTML = data.watchers_count;
        document.getElementById('watchers').innerHTML = data.subscribers_count;
        document.getElementById('forks').innerHTML = data.forks_count;

        getLanguages(data.languages_url);
    }

    getRepo();
</script>

</html>